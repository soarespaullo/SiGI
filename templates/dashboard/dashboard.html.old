{% extends "base.html" %}
{% block title %}Dashboard - SiGI{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/charts.css') }}">
{% endblock %}

{% block content %}

<div class="container mt-4">

  <!-- Header -->
  <div class="dashboard-header">
    <h2>Dashboard</h2>
    <p class="text-muted mb-0">Bem-vindo, {{ user_name }}!</p>
  </div>

  <!-- Cards principais -->
  <div class="row g-4">
    <!-- Card de Membros com link -->
    <div class="col-md-3">
      <a href="{{ url_for('member.listar_membros') }}" class="text-decoration-none">
        <div class="card dashboard-card h-100">
          <div class="card-body text-center">
            <div class="dashboard-icon bg-primary bg-opacity-10">
              <i class="bi bi-people fs-3 text-primary"></i>
            </div>
            <h6>Membros</h6>
            <h3 class="text-primary">{{ total_membros }}</h3>
          </div>
        </div>
      </a>
    </div>

    <div class="col-md-3">
      <div class="card dashboard-card h-100">
        <div class="card-body text-center">
          <div class="dashboard-icon bg-success bg-opacity-10">
            <i class="bi bi-check-circle fs-3 text-success"></i>
          </div>
          <h6>Batizados</h6>
          <h3 class="text-success">{{ total_batizados }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card dashboard-card h-100">
        <div class="card-body text-center">
          <div class="dashboard-icon bg-warning bg-opacity-10">
            <i class="bi bi-cash-coin fs-3 text-warning"></i>
          </div>
          <h6>Dizimistas</h6>
          <h3 class="text-warning">{{ total_dizimistas }}</h3>
        </div>
      </div>
    </div>

    <!-- Card de Eventos com link -->
    <div class="col-md-3">
      <a href="{{ url_for('event.listar_eventos') }}" class="text-decoration-none">
        <div class="card dashboard-card h-100">
          <div class="card-body text-center">
            <div class="dashboard-icon bg-info bg-opacity-10">
              <i class="bi bi-calendar-event fs-3 text-info"></i>
            </div>
            <h6>Eventos</h6>
            <h3 class="text-info">{{ total_eventos }}</h3>
          </div>
        </div>
      </a>
    </div>
  </div>

  <!-- Cards extras -->
  <div class="row g-4 mt-4">
    <!-- Saídas Financeiras -->
    <div class="col-md-6">
      <div class="card dashboard-card h-100">
        <div class="card-body text-center">
          <div class="dashboard-icon bg-danger bg-opacity-10">
            <i class="bi bi-cash-stack fs-3 text-danger"></i>
          </div>
          <h6>Saídas Financeiras</h6>
          <h3 class="text-danger">{{ total_saidas }}</h3>
        </div>
      </div>
    </div>

    <!-- Próximos Aniversariantes -->
    <div class="col-md-6">
      <div class="card dashboard-card h-100">
        <div class="card-body">
          <div class="dashboard-icon bg-secondary bg-opacity-10 text-center mb-2">
            <i class="bi bi-gift fs-3 text-secondary"></i>
          </div>
          <h6 class="text-center">Aniversariantes do Mês</h6>
          <ul class="list-group list-group-flush">
            {% for aniversariante in proximos_aniversariantes %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ aniversariante.nome }}
                <span class="badge bg-secondary">{{ aniversariante.data_nascimento.strftime('%d-%m') }}</span>
              </li>
            {% else %}
              <li class="list-group-item text-muted text-center">Nenhum aniversariante este mês</li>
            {% endfor %}
          </ul>
          <!-- Botão Ver Todos -->
          <div class="text-center mt-3">
            <a href="{{ url_for('member.aniversariantes_mes') }}" class="btn btn-outline-secondary btn-sm">
              Ver todos
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="row g-4 mt-4">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Distribuição de Membros</h5>
          <div class="chart-container">
            <canvas id="membrosChart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Financeiro</h5>
          <div class="chart-container">
            <canvas id="financeiroChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Gráfico de membros
  new Chart(document.getElementById('membrosChart'), {
    type: 'doughnut',
    data: {
      labels: ['Batizados', 'Não Batizados'],
      datasets: [{
        data: [{{ total_batizados }}, {{ total_membros - total_batizados }}],
        backgroundColor: ['#0d6efd', '#6c757d']
      }]
    }
  });

  // Gráfico financeiro (Entradas e Saídas)
  new Chart(document.getElementById('financeiroChart'), {
    type: 'bar',
    data: {
      labels: {{ meses_labels|tojson }},
      datasets: [
        {
          label: 'Entradas (R$)',
          data: {{ financeiro_mensal|tojson }},
          backgroundColor: '#198754'
        },
        {
          label: 'Saídas (R$)',
          data: {{ financeiro_saidas|tojson }},
          backgroundColor: '#dc3545'
        }
      ]
    },
    options: {
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>
{% endblock %}
