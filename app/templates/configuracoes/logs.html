{% extends "base.html" %}
{% block title %}Logs do Sistema{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2><i class="bi bi-journal-text text-primary"></i> Logs do Sistema</h2>
    <a href="{{ url_for('configuracoes.configuracoes') }}" class="btn btn-secondary" title="Voltar para Configura√ß√µes">
      <i class="bi bi-arrow-left-circle"></i>
    </a>
  </div>

  <div class="card shadow-sm mb-4 border-primary">
    <div class="card-body">
      <h5 class="card-title text-primary">
        <i class="bi bi-info-circle"></i> Registros de atividades
      </h5>
      <p class="mb-0">
        Aqui voc√™ pode visualizar os registros de auditoria do sistema.  
        Cada a√ß√£o realizada por usu√°rios administradores ou eventos cr√≠ticos √© registrada.
      </p>
    </div>
  </div>

  <!-- üîé Filtro por usu√°rio -->
  <form method="get" class="mb-3 d-flex align-items-center">
    <input type="text" name="usuario" value="{{ usuario }}" class="form-control me-2" placeholder="Filtrar por usu√°rio">
    <button type="submit" class="btn btn-primary me-2">Filtrar</button>
    <a href="{{ url_for('configuracoes.logs.remover_logs') }}" class="btn btn-danger" title="Remover Logs antigos">
      <i class="bi bi-trash"></i>
    </a>
  </form>

  <!-- Wrapper responsivo -->
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-primary">
        <tr>
          <th>Usu√°rio</th>
          <th>Data</th>
          <th>Hora</th>
          <th>IP</th>
          <th>Tarefa</th>
          <th>Resultado</th>
        </tr>
      </thead>
      <tbody>
        {% for log in registros.items %}
        <tr>
          <td><span class="badge bg-primary">{{ log.usuario }}</span></td>
          <td>{{ (log.datahora|to_local).strftime("%d/%m/%Y") }}</td>
          <td>{{ (log.datahora|to_local).strftime("%H:%M:%S") }}</td>
          <td>{{ log.ip }}</td>
          <td>{{ log.tarefa }}</td>
          <td>
            {% if log.resultado == "sucesso" %}
              <span class="badge bg-success">Sucesso</span>
            {% elif log.resultado == "erro" %}
              <span class="badge bg-danger">Erro</span>
            {% elif log.resultado == "info" %}
              <span class="badge bg-info text-dark">Info</span>
            {% else %}
              <span class="badge bg-secondary">{{ log.resultado }}</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- üìÑ Pagina√ß√£o (s√≥ aparece se houver mais de 20 registros) -->
  {% if registros.total > 20 %}
  <nav aria-label="Navega√ß√£o de p√°ginas">
    <ul class="pagination justify-content-center">
      {% if registros.has_prev %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('configuracoes.logs.visualizar_logs', page=registros.prev_num, usuario=usuario) }}">Anterior</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Anterior</span></li>
      {% endif %}

      <li class="page-item disabled">
        <span class="page-link">P√°gina {{ registros.page }} de {{ registros.pages }}</span>
      </li>

      {% if registros.has_next %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('configuracoes.logs.visualizar_logs', page=registros.next_num, usuario=usuario) }}">Pr√≥xima</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Pr√≥xima</span></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>
{% endblock %}
