{% extends "base.html" %}
{% block title %}Editar Usuário{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2><i class="bi bi-pencil-square text-primary"></i> Editar Usuário</h2>
  <div class="card shadow-sm mt-3">
    <div class="card-body">

      <!-- Foto de Perfil no topo -->
      <div class="text-center mb-4">
        {% if usuario.foto %}
          <img src="{{ url_for('static', filename='uploads/' ~ usuario.foto) }}" 
               alt="Foto de {{ usuario.nome }}"
               style="width:140px; height:140px; object-fit:cover; border-radius:50%; border:3px solid #0d6efd; 
                      box-shadow:0 2px 6px rgba(0,0,0,0.3); display:inline-block; vertical-align:middle;">
          <p class="text-muted mt-2">Foto atual</p>
          <!-- Form separado para remover foto -->
          <form method="POST" action="{{ url_for('configuracoes.usuarios.remover_foto', id=usuario.id) }}" class="mt-2">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-sm btn-outline-danger">
              <i class="bi bi-trash"></i> Remover Foto
            </button>
          </form>
        {% else %}
          <!-- Avatar circular sem foto -->
          <div style="width:140px; height:140px; border-radius:50%; border:3px solid #dee2e6;
                      display:inline-flex; align-items:center; justify-content:center;
                      box-shadow:0 2px 6px rgba(0,0,0,0.3); background-color:#f8f9fa; vertical-align:middle;">
            <i class="bi bi-person" style="font-size:4rem; color:#6c757d;"></i>
          </div>
        {% endif %}
      </div>

      <!-- Form principal -->
      <form method="POST" enctype="multipart/form-data" autocomplete="off">
        {{ form.hidden_tag() }}

        <!-- Input de upload dentro do form -->
        <div class="mt-3 text-center" style="max-width:400px; margin:auto;">
          {{ form.foto(class="form-control" + (" is-invalid" if form.foto.errors else "")) }}
          {% for error in form.foto.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Nome -->
        <div class="mb-3 mt-4">
          {{ form.nome.label(class="form-label") }}
          {{ form.nome(class="form-control" + (" is-invalid" if form.nome.errors else ""), placeholder="Digite o nome completo") }}
          {% for error in form.nome.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Email -->
        <div class="mb-3">
          {{ form.email.label(class="form-label") }}
          {{ form.email(class="form-control" + (" is-invalid" if form.email.errors else ""), placeholder="exemplo@dominio.com") }}
          {% for error in form.email.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Senha (opcional) -->
        <div class="mb-3">
          {{ form.senha.label(class="form-label") }}
          {{ form.senha(class="form-control" + (" is-invalid" if form.senha.errors else ""), type="password", placeholder="Deixe em branco para manter") }}
          {% for error in form.senha.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Papel -->
        <div class="mb-3">
          {{ form.role.label(class="form-label") }}
          {{ form.role(class="form-select" + (" is-invalid" if form.role.errors else "")) }}
          {% for error in form.role.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Status (Ativo/Inativo) -->
        <div class="mb-3">
          {{ form.ativo.label(class="form-label") }}
          {{ form.ativo(class="form-select" + (" is-invalid" if form.ativo.errors else "")) }}
          {% for error in form.ativo.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Botões -->
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-check-circle"></i> Salvar
        </button>
        <a href="{{ url_for('configuracoes.usuarios.usuarios_page') }}" class="btn btn-secondary">
          <i class="bi bi-x-circle"></i> Cancelar
        </a>
      </form>
    </div>
  </div>
</div>
{% endblock %}
